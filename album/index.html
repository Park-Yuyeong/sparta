<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë‚´ì¼ë°°ì›€ìº í”„ë¥¼ ì‹œì‘í•˜ë©°</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Jua&display=swap');

        * {
            font-family: "Jua", sans-serif;
            font-weight: 400;
            font-style: normal;
        }

        .mytitle {
            height: 250px;
            color: white;

            /* ì•ˆì— ìˆëŠ” ë‚´ìš©ë¬¼ ê°€ìš´ë° ì •ë ¬í•˜ê¸° */
            display: flex;
            flex-direction: column;
            /* rowë¡œ í•˜ë©´ ê°€ë¡œ ê°€ìš´ë°ë¡œ ì •ë ¬ë¨ */
            align-items: center;
            justify-content: center;

            background-image: url('../album/zep.png');
            background-position: center;
            background-size: cover;
        }

        .mytitle>button {
            width: 150px;
            height: 50px;
            background-color: transparent;
            /* transparent: ë°°ê²½ íˆ¬ëª…í•˜ê²Œ */
            color: white;
            border: 1px solid white;
            border-radius: 5px;

            margin-top: 20px;
        }

        .mycard {
            width: 1200px;

            margin: 30px auto 0px auto;
        }

        .mypostingbox {
            width: 500px;

            margin: 30px auto 0px auto;
            padding: 20px;

            box-shadow: 0px 0px 3px 0px blue;
            border-radius: 5px;
        }

        .mybtn {
            display: flex;
            flex-direction: row;
            align-items: center;
            justify-content: center;
        }

        .mybtn>button {
            margin-right: 5px;
        }
    </style>
    <script type="module">
        // Firebase SDK ë¼ì´ë¸ŒëŸ¬ë¦¬ ê°€ì ¸ì˜¤ê¸°
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js";
        import { getFirestore } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js";
        import { collection, addDoc } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js";
        import { getDocs } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js";


        // Firebase êµ¬ì„± ì •ë³´ ì„¤ì •
        // For Firebase JS SDK v7.20.0 and later, measurementId is optional
        // firebase config ì…ë ¥
        // firebase console > í”„ë¡œì íŠ¸ ì„¤ì • > êµ¬ì„±
        const firebaseConfig = {
            
        };


        // Firebase ì¸ìŠ¤í„´ìŠ¤ ì´ˆê¸°í™”
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        // <script>ë¶€ë¶„ì˜ typeì„ moduleë¡œ ë°”ê¾¸ë©´ ë” ì´ìƒ ë°–ì—ì„œ onclickìœ¼ë¡œ ë¶ˆë¦¬ëŠ” ê²ƒë“¤ì´ ì˜ ì•ˆ ëœë‹¤.
        // ì•„ë˜ëŠ” í•´ë‹¹ idê°’ì— click eventê°€ ë°œìƒí–ˆì„ ë–„ ìˆ˜í–‰ë˜ëŠ” í•¨ìˆ˜ì´ë‹¤.
        $("#postingbtn").click(async function () {
            let image = $('#image').val();
            let title = $('#title').val();
            let content = $('#content').val();
            let date = $('#date').val();

            let doc = {
                'image': image,
                'title': title,
                'content': content,
                'date': date
            }; // ë„£ê³  ì‹¶ì€ ë°ì´í„°
            await addDoc(collection(db, "albums"), doc); // addDoc: firebaseì— ìƒˆë¡œìš´ ë¬¸ì„œ ì¶”ê°€
            alert('ì €ì¥ ì™„ë£Œ!');
            window.location.reload(); // ìƒˆë¡œê³ ì¹¨
        })

        $("#savebtn").click(async function () {
            $('#postingbox').toggle();
            // ê¸°ë¡ ì €ì¥í•˜ê¸° ë²„íŠ¼ í´ë¦­ì‹œ mypostingbox êµ¬ì—­ì˜
            // display: noneì´ on/off ë¨
        })

        let url = ""; // fetchí•  url ì…ë ¥ 
        fetch(url).then(res => res.json()).then(data => {
            let mise = data['response']['body']['items'][0]['pm10Value'];
            alert(`í˜„ì¬ ë¯¸ì„¸ë¨¼ì§€ ë†ë„ëŠ” ${mise} ì…ë‹ˆë‹¤`);

            if (mise < 16) {
                $('#mise').text('ğŸ˜€');
            }
            else if (mise > 50) {
                $('#mise').text('ğŸ˜¡');
            } else {
                $('#mise').text('ğŸ˜');
            }
        })

        // ì¹´ë“œë¥¼ ë¶™ì´ëŠ” ì½”ë“œ
        // getDocs: firebaseì—ì„œ ë¬¸ì„œë“¤ì„ ë°›ì•„ì˜¤ê¸°
        let docs = await getDocs(collection(db, "albums"));
        docs.forEach((doc) => {
            let row = doc.data();

            let image = row['image'];
            let title = row['title'];
            let content = row['content'];
            let date = row['date'];

            let temp_html = `
            <div class="col">
                <div class="card h-100">
                    <img src="${image}"
                        class="card-img-top" alt="...">
                    <div class="card-body">
                        <h5 class="card-title">${title}</h5>
                        <p class="card-text">${content}</p>
                    </div>
                    <div class="card-footer">
                        <small class="text-body-secondary">${date}</small>
                    </div>
                </div>
            </div>`;

            $('#card').append(temp_html);
        });
    </script>
</head>

<body>
    <div class="mytitle">
        <h1>ë‚´ì¼ë°°ì›€ìº í”„ë¥¼ ì‹œì‘í•˜ë©°</h1>
        <p>í˜„ì¬ ë¯¸ì„¸ë¨¼ì§€ : <span id="mise"></span></p>
        <button id="savebtn">ê¸°ë¡ ì €ì¥í•˜ê¸°</button>
    </div>
    <div class="mypostingbox" id="postingbox">
        <div class="form-floating mb-3">
            <input type="email" class="form-control" id="image" placeholder="ë§í¬ë¥¼ ì ì–´ì£¼ì„¸ìš”">
            <label for="floatingInput">ì˜¤ëŠ˜ ê³µë¶€í•œ ë‚´ìš© ì´ë¯¸ì§€</label>
        </div>
        <div class="form-floating mb-3">
            <input type="email" class="form-control" id="title" placeholder="ì˜¤ëŠ˜ë„ í™”ì´íŒ…!">
            <label for="floatingInput">ì˜¤ëŠ˜ì˜ ë‹¤ì§ í•œ ë§ˆë””</label>
        </div>
        <div class="form-floating mb-3">
            <input type="email" class="form-control" id="content" placeholder="ì˜¤ëŠ˜ì˜ í•™ìŠµ ëª©í‘œ">
            <label for="floatingInput">ì˜¤ëŠ˜ì˜ í•™ìŠµ ëª©í‘œ</label>
        </div>
        <div class="form-floating mb-3">
            <input type="email" class="form-control" id="date" placeholder="ë‚ ì§œ">
            <label for="floatingInput">ë‚ ì§œ</label>
        </div>
        <div class="mybtn">
            <button id="postingbtn" type="button" class="btn btn-primary">ê¸°ë¡í•˜ê¸°</button>
            <button type="button" class="btn btn-outline-primary">ë‹«ê¸°</button>
        </div>
    </div>
    <div class="mycard">
        <div id="card" class="row row-cols-1 row-cols-md-4 g-4">

        </div>
    </div>

</body>

</html>